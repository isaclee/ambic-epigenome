#!/bin/bash

fastq=$(basename "$1")
prefix=${fastq%.*}

genome=$2

case $genome in 
    lambda )
	echo "lambda"
	reffasta=/mithril/Data/NGS/Reference/lambda/lambda.fasta
	;;
    ecoli )
	echo "ecoli"
	reffasta=/mithril/Data/NGS/Reference/ecoli/ecoli.fasta
	;;
    nebecoli )
	echo "nebecoli"
	reffasta=/mithril/Data/NGS/Reference/neb_er2796/ER2796.fasta
	;;
    pfal )
	echo "pfal"
	reffasta=/mithril/Data/NGS/Reference/pfal/pfal.fasta
	;;
    human )
	echo "human"
	reffasta=/mithril/Data/NGS/Reference/human/hg19.fa
	;;
    human38 )
	echo "human38"
	reffasta=/atium/Data/Reference/human/hg38/GRCh38.primary_assembly.genome.fa
	;;
esac


echo $prefix


##BWA

##Make database/ref
#lastdb lambda lambda.fasta
##~/Code/bwa/bwa index ref.fa

##Human default right now

#bwa mem -t 8 -x ont2d ${reffasta} \
#    ${fastq} | samtools view -S -b - | samtools sort - -o ${prefix}.sorted.bam


echo "Index"

samtools index ${prefix}.sorted.bam 

echo "Calmd"

samtools calmd -b ${prefix}.sorted.bam ${reffasta} >${prefix}.md.bam


samtools index ${prefix}.md.bam 

python3 ~/Code/timp_nanopore/oxford/bam_extract.py ${prefix}.md.bam

bedtools genomecov -ibam ${prefix}.sorted.bam -g ${reffasta}.fai >${prefix}.cov








